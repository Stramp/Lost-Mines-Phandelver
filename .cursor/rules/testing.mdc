---
description: Rules and patterns for testing in the project
globs: ["*.cpp", "*.h"]
alwaysApply: true
---

# Testing Rules

## Testing Principles

### What to Test

**ALWAYS test:**
- ✅ Helper/utility functions (in `Utils/`)
- ✅ Pure functions (no side effects)
- ✅ Complex calculation logic
- ✅ Validations and edge cases
- ✅ Critical gameplay functions

**Don't need to test:**
- ❌ Simple Getters/Setters
- ❌ Simple wrappers of Unreal API
- ❌ Automatically generated code

### Test Structure (AAA Pattern)

**Arrange** - Prepare data and context
**Act** - Execute the function being tested
**Assert** - Verify the result

```cpp
TEST(ComponentHelpers, FindCharacterDataComponent_WithValidOwner_ReturnsComponent)
{
    // Arrange
    AActor* TestActor = NewObject<AActor>();
    UCharacterDataComponent* ExpectedComponent = NewObject<UCharacterDataComponent>(TestActor);
    TestActor->AddComponent(ExpectedComponent);

    // Act
    UCharacterDataComponent* Result = ComponentHelpers::FindCharacterDataComponent(TestActor);

    // Assert
    EXPECT_NE(Result, nullptr);
    EXPECT_EQ(Result, ExpectedComponent);
}
```

## Test Naming

### Format

```
TEST(<TestSuite>, <TestName>)
```

### TestSuite

Name of the class/function being tested:
- `ComponentHelpers` - For ComponentHelpers namespace functions
- `CharacterSheetComponent` - For class methods
- `CharacterDataComponent` - For class methods

### TestName

Format: `<Scenario>_<Condition>_<ExpectedResult>`

Examples:
- `FindCharacterDataComponent_WithValidOwner_ReturnsComponent`
- `FindCharacterDataComponent_WithNullOwner_ReturnsNullptr`
- `FindCharacterDataComponent_WithoutComponent_ReturnsNullptr`
- `CalculateFinalAttributes_WithBaseAttributes_CalculatesCorrectly`

## Mandatory Test Cases

### For Helper Functions

**ALWAYS test:**

1. **Valid case/happy path**
   ```cpp
   TEST(ComponentHelpers, FindCharacterDataComponent_WithValidOwner_ReturnsComponent)
   ```

2. **Nullptr/null input**
   ```cpp
   TEST(ComponentHelpers, FindCharacterDataComponent_WithNullOwner_ReturnsNullptr)
   ```

3. **Not found case**
   ```cpp
   TEST(ComponentHelpers, FindCharacterDataComponent_WithoutComponent_ReturnsNullptr)
   ```

### For Calculation Functions

**ALWAYS test:**

1. **Normal values**
2. **Extreme values** (0, maximum, negative if applicable)
3. **Invalid values** (nullptr, values out of range)

## Test Organization

### Directory Structure

```
Source/MyProject2/
├── Utils/
│   ├── ComponentHelpers.h
│   ├── ComponentHelpers.cpp
│   └── Tests/
│       └── ComponentHelpersTests.cpp
```

### Test File

```cpp
// ComponentHelpersTests.cpp
#include "Misc/AutomationTest.h"
#include "Utils/ComponentHelpers.h"
#include "Characters/Components/CharacterDataComponent.h"
#include "GameFramework/Actor.h"

BEGIN_DEFINE_SPEC(ComponentHelpersSpec, "MyProject2.Utils.ComponentHelpers", EAutomationTestFlags::ApplicationContextMask | EAutomationTestFlags::ProductFilter)

END_DEFINE_SPEC(ComponentHelpersSpec)

void ComponentHelpersSpec::Define()
{
    Describe("FindCharacterDataComponent", [this]()
    {
        It("should return component when owner has it", [this]()
        {
            // Test implementation
        });

        It("should return nullptr when owner is null", [this]()
        {
            // Test implementation
        });
    });
}
```

## Implementation Rules

### 1. Tests Must Be Independent

- Each test must be able to run in isolation
- Don't depend on execution order
- Clean state between tests

### 2. Tests Must Be Fast

- Avoid slow operations (I/O, network)
- Use mocks when necessary
- Keep unit tests fast (< 1 second each)

### 3. Tests Must Be Deterministic

- Always produce the same result
- Don't use random values without fixed seed
- Avoid time/date dependencies

### 4. One Test = One Thing

- Test one functionality at a time
- Test name must make clear what is being tested
- If need to test multiple things, create multiple tests

## Testing Checklist

Before considering code "ready":

- [ ] Helper functions have tests?
- [ ] Edge cases are covered (nullptr, invalid values)?
- [ ] Tests pass locally?
- [ ] Tests are independent?
- [ ] Tests are fast (< 1 second each)?
- [ ] Test names are descriptive?

## When to Write Tests

**ALWAYS write tests when:**
- Create new helper function in `Utils/`
- Implement complex calculation logic
- Refactor critical code
- Fix bug (add test that reproduces the bug)

**Can skip tests when:**
- Code is very simple (getter/setter)
- It's direct wrapper of Unreal API
- It's temporary code (but remember: shouldn't have temporary code!)

## Benefits

- ✅ Detects bugs before committing
- ✅ Confidence when refactoring
- ✅ Living documentation (tests show how to use)
- ✅ Facilitates continuous integration (CI/CD)
- ✅ Improves code quality
